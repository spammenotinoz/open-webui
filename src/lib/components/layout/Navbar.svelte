<script lang="ts">
    import { getContext } from 'svelte';
    import { toast } from 'svelte-sonner';
    import { WEBUI_NAME, chatId, modelfiles, settings, showSettings } from '$lib/stores';
    import { slide } from 'svelte/transition';
    import ShareChatModal from '../chat/ShareChatModal.svelte';
    import ModelSelector from '../chat/ModelSelector.svelte';
    import Tooltip from '../common/Tooltip.svelte';
    import Menu from './Navbar/Menu.svelte';
    import { page } from '$app/stores';

    const i18n = getContext('i18n');

    export let initNewChat: Function;
    export let title: string = $WEBUI_NAME;
    export let shareEnabled: boolean = false;
    export let chat;
    export let selectedModels;
    export let showModelSelector = true;
    let showShareChatModal = false;
    let showDownloadChatModal = false;

    // Add an event handler to initialize new chat when a model is selected
    const handleModelSelect = () => {
        initNewChat();
    };
</script>

<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />
<nav id="nav" class=" sticky py-2.5 top-0 flex flex-row justify-center z-30">
    <div class=" flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1.3rem]">
        <div class="flex items-center w-full max-w-full">
            <div class="flex-1 overflow-hidden max-w-full">
                {#if showModelSelector}
                    <ModelSelector bind:selectedModels showSetDefault={!shareEnabled} on:modelSelect={handleModelSelect} />
                {/if}
            </div>

            <div class="self-start flex flex-none items-center">
                <div class="md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700" />

                {#if !shareEnabled}
                    <Tooltip content={$i18n.t('Settings')}>
                        <button
                            class="cursor-pointer p-1.5 flex dark:hover:bg-gray-700 rounded-full transition"
                            id="open-settings-button"
                            on:click={async () => {
                                await showSettings.set(!$showSettings);
                            }}
                        >
                            <!-- SVG for settings icon -->
                        </button>
                    </Tooltip>
                {:else}
                    <Menu
                        {chat}
                        {shareEnabled}
                        shareHandler={() => {
                            showShareChatModal = !showShareChatModal;
                        }}
                        downloadHandler={() => {
                            showDownloadChatModal = !showDownloadChatModal;
                        }}
                    >
                        						<button
							class="cursor-pointer p-1.5 flex dark:hover:bg-gray-700 rounded-full transition"
						>
							<div class=" m-auto self-center">
								<svg
									xmlns="http://www.w3.org/2000/svg"
									fill="none"
									viewBox="0 0 24 24"
									stroke-width="1.5"
									stroke="currentColor"
									class="size-5"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"
									/>
								</svg>
							</div>
						</button>
                    </Menu>
                {/if}
                <Tooltip content={$i18n.t('New Chat')}>
                    <button
                        id="new-chat-button"
                        class=" cursor-pointer p-1.5 flex dark:hover:bg-gray-700 rounded-full transition"
                        on:click={() => {
                            initNewChat();
                        }}
                    >
                        	<svg
								xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 20 20"
								fill="currentColor"
								class="w-5 h-5"
							>
								<path
									d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"
								/>
								<path
									d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"
								/>
							</svg>
                    </button>
                </Tooltip>
            </div>
        </div>
    </div>
</nav>

